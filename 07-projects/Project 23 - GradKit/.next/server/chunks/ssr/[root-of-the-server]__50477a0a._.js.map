{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///R:/NextJS/Bigproject/gradkit/app/%28main%29/learning-feed/page.jsx"],"sourcesContent":["\"use server\";\r\n\r\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\r\n\r\n// Initialize the Gemini client\r\nconst genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);\r\n// Use the correct model that supports search grounding\r\nconst model = genAI.getGenerativeModel({ model: \"gemini-2.5-flash-preview-09-2025\" });\r\n\r\n// Define a strict JSON schema for the model's output\r\nconst responseSchema = {\r\n  type: \"ARRAY\",\r\n  items: {\r\n    type: \"OBJECT\",\r\n    properties: {\r\n      title: { type: \"STRING\" },\r\n      type: { type: \"STRING\" },\r\n      source: { type: \"STRING\" },\r\n      time: { type: \"STRING\" },\r\n      summary: { type: \"ARRAY\", items: { type: \"STRING\" } },\r\n      relevance: { type: \"STRING\" },\r\n      link: { type: \"STRING\" },\r\n    },\r\n    required: [\"title\", \"type\", \"source\", \"time\", \"summary\", \"relevance\", \"link\"],\r\n  },\r\n};\r\n\r\n/**\r\n * Server Action to generate a personalized learning feed.\r\n * @param {object} data - The user's input\r\n * @param {string} data.industry - The user's industry\r\n * @param {string[]} data.skills - A list of user's skills\r\n * @param {string[]} data.interests - A list of user's interests\r\n * @returns {Promise<{feed?: object[], error?: string}>} - An object containing the feed or an error\r\n */\r\nexport async function LearningFeed({ industry, skills, interests }) {\r\n  try {\r\n    // Validate input\r\n    if (!industry && (!skills || skills.length === 0) && (!interests || interests.length === 0)) {\r\n      return { error: \"Please provide at least one field (industry, skills, interests)\" };\r\n    }\r\n\r\n    // Update the prompt to be professional and explicitly command the use of search\r\n    const prompt = `\r\n      You are a professional career development assistant. Your task is to generate a personalized learning feed \r\n      of exactly 5 items for a user with the following profile:\r\n      Industry: ${industry || \"General\"}\r\n      Skills: ${skills?.join(\", \") || \"None\"}\r\n      Interests: ${interests?.join(\", \") || \"General Knowledge\"}\r\n\r\n      **You MUST use your search tool** to find real, high-quality, and currently available online content. \r\n      Do not invent content or provide placeholder links.\r\n\r\n      For each item, provide:\r\n      - title: The actual title of the content.\r\n      - type: (e.g., Article, Video, Podcast, Course).\r\n      - source: The name of the website or platform (e.g., TechCrunch, YouTube, Coursera).\r\n      - time: Estimated consumption time (e.g., \"5 min read\", \"25 min video\").\r\n      - summary: 3 concise bullet points of what the user will learn.\r\n      - relevance: A brief explanation of why this is relevant to the user's profile.\r\n      - link: **The direct, real, and valid URL** to the content.\r\n    `;\r\n\r\n    // Call the model with search tools and JSON mode enabled\r\n    const result = await model.generateContent({\r\n      contents: [{ parts: [{ text: prompt }] }],\r\n      // Enable Google Search grounding to get real links\r\n      tools: [{ \"google_search\": {} }],\r\n      // Enforce valid JSON output to prevent parsing errors\r\n      generationConfig: {\r\n        responseMimeType: \"application/json\",\r\n        responseSchema: responseSchema,\r\n      },\r\n    });\r\n\r\n    const response = result.response;\r\n\r\n    // Professional error handling and response parsing\r\n    if (!response || !response.parts || response.parts.length === 0) {\r\n      if (response.promptFeedback?.blockReason) {\r\n        console.error(\"Prompt was blocked:\", response.promptFeedback.blockReason);\r\n        return { error: `Request blocked due to: ${response.promptFeedback.blockReason}. Please adjust your input.` };\r\n      }\r\n      if (response.candidates?.[0]?.finishReason !== \"STOP\") {\r\n         console.error(\"Generation stopped for reason:\", response.candidates?.[0]?.finishReason);\r\n         return { error: `Generation failed: ${response.candidates?.[0]?.finishReason}`};\r\n      }\r\n      return { error: \"Received an empty response from the AI.\" };\r\n    }\r\n\r\n    // The text is now guaranteed to be a valid JSON string\r\n    const text = response.parts[0].text;\r\n    const feed = JSON.parse(text); \r\n\r\n    if (!Array.isArray(feed)) {\r\n        console.error(\"Parsed response is not an array:\", feed);\r\n        return { error: \"AI returned an invalid data format.\" };\r\n    }\r\n    \r\n    // Success: return the feed object\r\n    return { feed };\r\n\r\n  } catch (err) {\r\n    console.error(\"Learning Feed Server Action Error:\", err);\r\n    // Return an error object instead of throwing, which prevents the crash\r\n    return { error: err.message || \"A server error occurred while generating the feed.\" };\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAEA;;;;;AAEA,+BAA+B;AAC/B,MAAM,QAAQ,IAAI,oLAAkB,CAAC,QAAQ,GAAG,CAAC,cAAc;AAC/D,uDAAuD;AACvD,MAAM,QAAQ,MAAM,kBAAkB,CAAC;IAAE,OAAO;AAAmC;AAEnF,qDAAqD;AACrD,MAAM,iBAAiB;IACrB,MAAM;IACN,OAAO;QACL,MAAM;QACN,YAAY;YACV,OAAO;gBAAE,MAAM;YAAS;YACxB,MAAM;gBAAE,MAAM;YAAS;YACvB,QAAQ;gBAAE,MAAM;YAAS;YACzB,MAAM;gBAAE,MAAM;YAAS;YACvB,SAAS;gBAAE,MAAM;gBAAS,OAAO;oBAAE,MAAM;gBAAS;YAAE;YACpD,WAAW;gBAAE,MAAM;YAAS;YAC5B,MAAM;gBAAE,MAAM;YAAS;QACzB;QACA,UAAU;YAAC;YAAS;YAAQ;YAAU;YAAQ;YAAW;YAAa;SAAO;IAC/E;AACF;AAUO,eAAe,aAAa,EAAE,QAAQ,EAAE,MAAM,EAAE,SAAS,EAAE;IAChE,IAAI;QACF,iBAAiB;QACjB,IAAI,CAAC,YAAY,CAAC,CAAC,UAAU,OAAO,MAAM,KAAK,CAAC,KAAK,CAAC,CAAC,aAAa,UAAU,MAAM,KAAK,CAAC,GAAG;YAC3F,OAAO;gBAAE,OAAO;YAAkE;QACpF;QAEA,gFAAgF;QAChF,MAAM,SAAS,CAAC;;;gBAGJ,EAAE,YAAY,UAAU;cAC1B,EAAE,QAAQ,KAAK,SAAS,OAAO;iBAC5B,EAAE,WAAW,KAAK,SAAS,oBAAoB;;;;;;;;;;;;;IAa5D,CAAC;QAED,yDAAyD;QACzD,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;YACzC,UAAU;gBAAC;oBAAE,OAAO;wBAAC;4BAAE,MAAM;wBAAO;qBAAE;gBAAC;aAAE;YACzC,mDAAmD;YACnD,OAAO;gBAAC;oBAAE,iBAAiB,CAAC;gBAAE;aAAE;YAChC,sDAAsD;YACtD,kBAAkB;gBAChB,kBAAkB;gBAClB,gBAAgB;YAClB;QACF;QAEA,MAAM,WAAW,OAAO,QAAQ;QAEhC,mDAAmD;QACnD,IAAI,CAAC,YAAY,CAAC,SAAS,KAAK,IAAI,SAAS,KAAK,CAAC,MAAM,KAAK,GAAG;YAC/D,IAAI,SAAS,cAAc,EAAE,aAAa;gBACxC,QAAQ,KAAK,CAAC,uBAAuB,SAAS,cAAc,CAAC,WAAW;gBACxE,OAAO;oBAAE,OAAO,CAAC,wBAAwB,EAAE,SAAS,cAAc,CAAC,WAAW,CAAC,2BAA2B,CAAC;gBAAC;YAC9G;YACA,IAAI,SAAS,UAAU,EAAE,CAAC,EAAE,EAAE,iBAAiB,QAAQ;gBACpD,QAAQ,KAAK,CAAC,kCAAkC,SAAS,UAAU,EAAE,CAAC,EAAE,EAAE;gBAC1E,OAAO;oBAAE,OAAO,CAAC,mBAAmB,EAAE,SAAS,UAAU,EAAE,CAAC,EAAE,EAAE,cAAc;gBAAA;YACjF;YACA,OAAO;gBAAE,OAAO;YAA0C;QAC5D;QAEA,uDAAuD;QACvD,MAAM,OAAO,SAAS,KAAK,CAAC,EAAE,CAAC,IAAI;QACnC,MAAM,OAAO,KAAK,KAAK,CAAC;QAExB,IAAI,CAAC,MAAM,OAAO,CAAC,OAAO;YACtB,QAAQ,KAAK,CAAC,oCAAoC;YAClD,OAAO;gBAAE,OAAO;YAAsC;QAC1D;QAEA,kCAAkC;QAClC,OAAO;YAAE;QAAK;IAEhB,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,sCAAsC;QACpD,uEAAuE;QACvE,OAAO;YAAE,OAAO,IAAI,OAAO,IAAI;QAAqD;IACtF;AACF;;;IAxEsB;;AAAA,+OAAA","debugId":null}}]
}